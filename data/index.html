<!-- This webpage is developed to monitor Local Weather Conditions -->
<!DOCTYPE html>
<html lang="en-AU">

<head>
    <title>Weather Station</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Comment out before flashing into ESP32 -->
    <!-- <link rel="stylesheet" type="text/css" href="/data/style.css" />  -->
    <!--  -->

    <link rel="icon" type="image/png" href="gloryagro">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style" />
</head>

<body style="background-color: #cccccc83;">
    <div style="background-color: white;">
        <img style="height: 160px;" alt="SIFD" type="image/png" src="sifd" />
        <span id="time" style="position: relative;width: auto;font-size: xx-large;font-weight: bold;color: green;">

        </span>
        <div id="upcounter" style="color:midnightblue ;font-size:large; font-weight: bold;"></div>
        <div style="position: absolute;top: 8px;right: 16px;">
            <button type="button" style="display: inline-block;height:50px;width:100px;border-radius: 8px;"
                onclick="ota()">OTA</button>
        </div>
        <h1
            style="text-align: center; height: auto; background-color: darkcyan; color:whitesmoke;font-size: 50px; font-weight:bold;">
            WEATHER MONITOR</h1>
    </div>
    <table class="table table-striped table-hover" style="width: 30%; margin-left: auto; margin-right: auto;">
        <tr>
            <!-- Name of Columns on Table -->
            <th style="font-weight: bold; color: darkcyan;">PARAMETERS</th>
            <th style="font-weight: bold; color: darkcyan;">READINGS</th>
            <th style="font-weight: bold; color: darkcyan;">UNIT</th>
        </tr>
        <tbody>
            <tr>
                <td><b>Altitude</b></td>
                <td id="altitude">altitude</td>
                <td>m</td>
            </tr>
            <tr>
                <!-- Data on Rows on Table -->
                <td><b>Light Intensity</b></td>
                <td id="lux">lux</td>
                <td>lux</td>
            </tr>
            <tr>
                <td><b>Dry Air Temperature</b></td>
                <td id="drya_temp">drya_temp</td>
                <td>Â°C</td>
            </tr>
            <tr>
                <td><b>Air Temperature</b></td>
                <td id="a_temp">a_temp</td>
                <td>Â°C</td>
            </tr>
            <tr>
                <td><b>Soil Temperature</b></td>
                <td id="s_temp">s_temp</td>
                <td>Â°C</td>
            </tr>
            <tr>
                <td><b>Humidity</b></td>
                <td id="rel">rel</td>
                <td>%</td>
            </tr>
            <tr>
                <td><b>Soil Moisture</b></td>
                <td id="soilMoist">SoilMoist</td>
                <td>%</td>
            </tr>
            <tr>
                <td><b>Atm Pressure</b></td>
                <td id="pressure">pressure</td>
                <td>hPa</td>
            </tr>
            <tr>
                <td><b>Rain Gauge</b></td>
                <td id="rain">rain</td>
                <td>L/m^2</td>
            </tr>
            <tr>
                <td><b>Wind Speed</b></td>
                <td id="speed">speed</td>
                <td>m/s</td>
            </tr>
            <tr>
                <td><b>Wind Direction</b></td>
                <td id="direction">direction</td>
                <td></td>
                
            </tr>
        </tbody>
    </table>

    
</body>

<footer style="padding-top: 30px; text-align: center;">
    All Rights Reserved Glory Agro - Super Intensive Farming Division
    <br>
    Developed by Asmaul Rahat
    <!--This is a dummy frame-->
    <iframe name="hiddenFrame" width="0" height="0" style="display: none;"></iframe>
</footer>

<script> //Javascript Functions
    var ip;

    function checkAddress(buttoName) { // button function
        var checkbox = document.getElementById("inputForm").elements[buttoName];
        if (checkbox.checked) {
            checkbox.value = 1;
            console.log(checkbox.value)
        }
        else {
            checkbox.value = 0;
            console.log(checkbox.value)
        }
    }


    function ota() {
        window.location = 'http://' + ip + '/update';
    }

    function refreshTime() //Get Date and Time from local PC
    {
        var d = new Date();
        var hr = d.getHours().toLocaleString('en-AU', {
            minimumIntegerDigits: 2, useGrouping: false
        });    // Returns Hours (24 hr format) , shows 2 digits on default (g.h. 01, 02.....)
        var min = d.getMinutes().toLocaleString('en-AU', {
            minimumIntegerDigits: 2, useGrouping: false
        }); // Returns Minutes (0-59)
        var seconds = d.getSeconds().toLocaleString('en-AU', {
            minimumIntegerDigits: 2, useGrouping: false
        }); // Returns Seconds (0-59)

        var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        var day = days[d.getDay()]; // Returns Day of the Week
        var date = d.getDate();  // Returns Day of the Month
        var month = d.getMonth(); // Returns Month of the Year
        var year = d.getFullYear(); // Returns 4 digit year

        const timeDisplay = document.getElementById("time"); //Find id time on webpage
        timeDisplay.innerHTML = day + "   " + date + "/" + (month + 1) + "/" + year + "     " + hr + ":" + min + ":" + seconds; // Update time on webpage

    }
    setInterval(refreshTime, 1000); // Updates every 1000ms (1s)

    //Page Update Timer
    var timeleft = 11;
    setInterval(() => {
        if (timeleft <= 0) {
            //clearInterval(downloadTimer);
            timeleft = 11;
        } else {
            document.getElementById("upcounter").innerHTML = "New Data On Its Way ðŸš€ " + (timeleft - 1);
        }
        timeleft -= 1;
    }, 1000);


    if (!!window.EventSource)    //Event Update
    {
        var source = new EventSource('/events');
        source.addEventListener('open', function (e) {
            console.log("Events Connected");
        }, false);

        source.addEventListener('error', function (e) {
            if (e.target.readyState != EventSource.OPEN) {
                console.log("Events Disconnected");
            }
        }, false);

        source.addEventListener('message', function (e) {
            console.log("message", e.data);
        }, false);

        // Add variables down here
        source.addEventListener('ip', function (e) {  //ESP32 IP
            console.log("ip", e.data);
            ip = e.data;
        }, false);
        source.addEventListener('altitude', function (e) {
            console.log("altitude", e.data);
            document.getElementById("altitude").innerHTML = e.data;
        }, false);
        source.addEventListener('lux', function (e) {
            console.log("lux", e.data);
            document.getElementById("lux").innerHTML = e.data;
        }, false);
        source.addEventListener('drya_temp', function (e) {
            console.log("drya_temp", e.data);
            document.getElementById("drya_temp").innerHTML = e.data;
        }, false);
        source.addEventListener('a_temp', function (e) {
            console.log("a_temp", e.data);
            document.getElementById("a_temp").innerHTML = e.data;
        }, false);
        source.addEventListener('s_temp', function (e) {
            console.log("s_temp", e.data);
            document.getElementById("s_temp").innerHTML = e.data;
        }, false);
        source.addEventListener('rel', function (e) {
            console.log("rel", e.data);
            document.getElementById("rel").innerHTML = e.data;
        }, false);
        source.addEventListener('soilMoist', function (e) {
            console.log("soilMoist", e.data);
            document.getElementById("soilMoist").innerHTML = e.data;
        }, false);
        source.addEventListener('pressure', function (e) {
            console.log("pressure", e.data);
            document.getElementById("pressure").innerHTML = e.data;
        }, false);
        source.addEventListener('rain', function (e) {
            console.log("rain", e.data);
            document.getElementById("rain").innerHTML = e.data;
        }, false);
        source.addEventListener('speed', function (e) {
            console.log("speed", e.data);
            document.getElementById("speed").innerHTML = e.data;
        }, false);
        source.addEventListener('direction', function (e) {
            console.log("direction", e.data);
            document.getElementById("direction").innerHTML = e.data;
        }, false);
        // source.addEventListener('lp', function (e) {        // Input field
        //     console.log("lp", e.data);
        //     document.getElementById("inputForm").elements["lp"].value = e.data;
        // }, false);

    }

</script>

</body>

</html>


<!-- Next Activity
1) Return Last value from ESP32 to Form

-->

